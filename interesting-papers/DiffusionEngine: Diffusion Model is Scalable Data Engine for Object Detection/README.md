# DiffusionEngine: Diffusion Model is Scalable Data Engine for Object Detection
[paper link](https://arxiv.org/pdf/2309.03893) 
| Year | Introduction                                                         | Research Field                 |
| ---- | ------------------------------------------------------------ | -------------------- |
| 2023 | This paper describes a data engine called Diffusion Engine for data extension in object detection tasks.          |  Diffusion        |

## Methodology

### 1. Abstract
Existing approaches typically require manual collection or the use of generative models to obtain target images and perform data augmentation and labelling to produce training pairs, which is expensive, complex or lacks diversity. The method exploits the positional and semantic information in the Image Generation Model Language-Driven Diffusion Model (LDM) and matches it to the detection signal by learning a detection adapter. Specifically, DE uses an existing object detection benchmark test dataset to train the detection adapter, and then applies that adapter to the LDM to generate new images with annotations.

### 2. Method Description 
The paper presents a method called DiffusionEngine (DE) for scaling datasets and improving object detection performance in a single stage. This approach has three main advantages: only image detection pairs are required for training, the original image layout is preserved, and an existing labelled detection benchmark test dataset can be used without additional data collection and labelling efforts.

![image](https://github.com/user-attachments/assets/3ca85c0e-d071-478f-8fd8-4ead53631ea5)

### 3. Methodological improvements
  1. Compared to traditional methods based on adversarial sample generation or data augmentation, DE generates more accurate object instance detection results by using positional and semantic information from LDMs.
  
  2. In addition, DE further improves the detection performance by learning a detection adapter to match the location and semantic information in the LDM with the detection signal.

### 4. Issues addressed 
The method solves the problems in traditional data enhancement methods, such as the inability to accurately generate new object instances and the need for a large amount of manual labelling effort. Also, the method is applicable to many different object detection tasks and can be implemented without changing the LDM. Therefore, the method is important for the application of large-scale object detection tasks.

## Experiments
This paper focuses on the effect of using DiffusionEngine (DE) for data amplification and compares it with other data amplification methods. Specifically, the authors conducted the following comparison experiments:

**For the performance enhancement of target detection algorithms**: the authors used three different target detection algorithms, including single-stage RetinaNet, two-stage Faster-RCNN, and DINO without anchors, and used them in conjunction with the data generated by DE. The results show that DE significantly improves the mAP scores of the different algorithms, e.g. by 3.3% when using RetinaNet and 3.1% when using DINO.

![image](https://github.com/user-attachments/assets/a122842a-d6e0-449a-9c34-2563b9e6888d)

**Impact on pre-trained models**: the authors also investigated the impact of DE on pre-trained models. They used a fully supervised pre-training model and a self-supervised pre-training model and combined them with data generated by DE. The results show that the use of DE can further improve the mAP score, e.g. when using ResNet50 as the pre-training model, DE provided a 1.4% mAP boost.

**Impact on backplane and pre-training datasets**: the authors also investigated the impact of DE on different backplanes and pre-training datasets. They used two different backplates in the DINO framework; ResNet50 and Swin-L, and found that DE can provide higher mAP scores in these cases, e.g. providing a 3.1% mAP boost when using ResNet50 and a 1.7% mAP boost when using Swin-L.

![image](https://github.com/user-attachments/assets/ca9fa3b5-cf1a-4954-a0a3-6ca752f484a3)

**For learning rate tuning**: The authors also investigated the effect of DE on learning rate tuning. They observed changes in validation performance by varying the number of training iterations and found that increasing the number of training iterations without generated data leads to overfitting. Whereas, data generated using DE can further improve performance, suggesting that DE is an effective data augmentation technique rather than simple data repetition.

**For the evaluation of generalisation ability**: the authors also conducted experiments on the VOC-0712 dataset to verify the generalisation ability of DE. The results show that the data generated using DE alone can outperform the real manually labelled dataset and better performance can be achieved when the generated data is combined with the real data.

![image](https://github.com/user-attachments/assets/2e97a0f4-8ad6-4b84-b78f-e566bab79048)

**For the evaluation of cross-domain data augmentation**: finally, the authors also performed experiments on cross-domain data augmentation, using the Clipart-1k dataset. The results show that DE can significantly improve the performance of the model in cross-domain scenarios, e.g., when using DE-generated data, the performance of the model improves by 11.5% compared to when using only the Clipart dataset. 

![image](https://github.com/user-attachments/assets/5d037719-d495-4383-93ac-24f40e1e619f)

## Conclusion

### 1. Advantages of the Thesis
  1. **Simple but effective**: DiffusionEngine is a simple but effective engine for scaling object detection datasets. It forgoes a complex multi-stage process and instead designs a detection adapter that generates training pairs in a single stage, making it both efficient and flexible.
  
  2. **Original and scalable**: the detection adapter matches the implicit knowledge learnt from pre-trained diffusion models with task-aware signals, giving DiffusionEngine excellent annotation capabilities. In addition, DiffusionEngine has unlimited data scalability with the ability to scale by tens of thousands of data entries.
  
  3. **Advanced Image Processing Technology**: DiffusionEngine is based on the latest LDM (Language Diffusion Model) technology, which generates high-quality images guided by text.
  
  4. **Provides a new research direction**: The tool provides a new research direction for the field of object detection and promotes the further development of the field.

### 2. Innovative points
  1. **Introduction of a diffusion model**: the tool introduces the state-of-the-art LDM technique, which generates high-quality images when guided by text. This allows DiffusionEngine to not only scale the dataset, but also to generate high quality images.
  
  2. **Design of Detection Adapter**: the tool also designs a detection adapter that matches the implicit knowledge learnt from the pre-trained diffusion model with the task-aware signals to produce accurate annotations. This adapter design is an important innovation of the tool.
  
  3. **Scalability**: the DiffusionEngine has unlimited data scalability, capable of scaling tens of thousands of data. This is another innovative point of the tool.  

